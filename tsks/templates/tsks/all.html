<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% load static %}
    <link rel="stylesheet" href="{% static 'tsks/style.css' %}">

    <script>
        var saveButton = document.querySelector('button[type="submit"][form="save-form"]');
        var deleteButton = document.querySelector('button[type="submit"][form="delete-form"]');
        var checkboxes = document.querySelectorAll('input[type="checkbox"][name^="task-"]');
    
        saveButton.addEventListener('click', function() {
            var taskIds = [];
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].checked) {
                    taskIds.push(checkboxes[i].name.replace('task-', ''));
                }
            }
            document.getElementById('task_ids').value = taskIds.join(',');
        });
    
        deleteButton.addEventListener('click', function() {
            var taskIds = [];
            for (var i = 0; i < checkboxes.length; i++) {
                if (checkboxes[i].checked) {
                    taskIds.push(checkboxes[i].name.replace('task-', ''));
                }
            }
            document.getElementById('task_ids').value = taskIds.join(',');
        });
    </script>
    
    <title>Tasks</title>
</head>

<body class="list">
    <h1>Task List</h1>
    {% if latest_task_list %}
    <div class="dv_list">
        <ul>
            {% for task in latest_task_list %}
            <!-- <li><a href="/tsks/{{ task.id }}/">{{ task.task_name }}</a></li> -->
            <li><a href="{% url 'tsks:t_detail' task.id %}"><input type="checkbox" name="task-{{ task.id }}" {% if task.completed %}checked{% endif %}>
                {{ task.task_name }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <a class="addbtn" href="{% url 'tsks:index'%}">Add Task</a>
    <form method="post" action="{% url 'delete_tasks' %}">
        {% csrf_token %}
        <input type="hidden" name="task_ids" id="task_ids">
        <button type="submit">Delete</button>
    </form>
    
    {% else %}
    <p>No tasks are available.</p>
    <a class="addbtn" href="{% url 'tsks:index'%}">Add Task</a>
    <form method="post" action="{% url 'delete_tasks' %}">
        {% csrf_token %}
        <input type="hidden" name="task_ids" id="task_ids">
        <button type="submit">Delete</button>
    </form>
    
    {% endif %}

</html>